(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{DKyB:function(e,n,a){"use strict";a.r(n),a.d(n,"_frontmatter",(function(){return l})),a.d(n,"default",(function(){return m}));a("91GP"),a("rGqo"),a("yt8O"),a("Btvt"),a("RW0V"),a("q1tI");var t=a("7ljp"),i=a("013z");a("T0C+"),a("qKvR");function o(){return(o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e}).apply(this,arguments)}var r,l={},c=(r="PageDescription",function(e){return console.warn("Component "+r+" was not imported, exported, or provided by MDXProvider as global scope"),Object(t.b)("div",e)}),p={_frontmatter:l},s=i.a;function m(e){var n=e.components,a=function(e,n){if(null==e)return{};var a,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,["components"]);return Object(t.b)(s,o({},p,a,{components:n,mdxType:"MDXLayout"}),Object(t.b)(c,{mdxType:"PageDescription"},Object(t.b)("p",null,"Add a Cloudant integration to your backend service")),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"While logged into the IBM Cloud account use the resource list to find your pre installed Cloudant database instance name after your development cluster.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open the database instance dashboard.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Click on the Service Credentials on the left-hand menu.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"You will see the credentials for the database.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open a terminal window folder/directory called ",Object(t.b)("inlineCode",{parentName:"p"},"data")),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-bash"}),"mkdir data\n"))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"To help create test JSON data we are going to supply a template to the JSON Generator tool, this helps when creating dummy data for testing. Navigate to the following link ",Object(t.b)("a",o({parentName:"p"},{href:"https://www.json-generator.com/"}),"https://www.json-generator.com/"))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Replace the default template with the following template (using cut and paste). This will enable a 100 records of test data to be created to represent a products database. Click on the ",Object(t.b)("em",{parentName:"p"},"Generate")," button."),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-bash"}),"[\n  '{{repeat(1, 50)}}',\n  {\n    id: '{{objectId()}}',\n    manufacturer: '{{company().toUpperCase()}}',\n    name:  '{{lorem(3, \"words\")}}',\n    price: '{{floating(10, 1000, 2, \"0.00\")}}',\n    stock: '{{integer(1, 100)}}'\n  }\n]\n"))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Copy the generated contents on the right hand side into a file called ",Object(t.b)("inlineCode",{parentName:"p"},"inventory.json")," and save it into the same folder. Wrap the array with a docs statement."),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-json"}),'{\n  "docs": <Add Generated array here>\n}\n'))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Save the documents that will be loaded into Cloudant")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Download the ",Object(t.b)("inlineCode",{parentName:"p"},"dataload.sh")," script from the Iteration Zero repository - ",Object(t.b)("a",o({parentName:"p"},{href:"https://raw.githubusercontent.com/ibm-garage-cloud/ibm-garage-iteration-zero/master/terraform/scripts/dataload.sh"}),"https://raw.githubusercontent.com/ibm-garage-cloud/ibm-garage-iteration-zero/master/terraform/scripts/dataload.sh"))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Add the ",Object(t.b)("inlineCode",{parentName:"p"},"username")," and ",Object(t.b)("inlineCode",{parentName:"p"},"apikey")," to ",Object(t.b)("inlineCode",{parentName:"p"},"CLOUDANT_USERNAME")," and ",Object(t.b)("inlineCode",{parentName:"p"},"CLOUDANT_API_KEY")," variables in the ",Object(t.b)("inlineCode",{parentName:"p"},"dataload.sh")," script.\nYou can get the credentials from the Cloudant credentials view in the IBM Cloud console.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Add ",Object(t.b)("inlineCode",{parentName:"p"},"DATABASE")," value to be ",Object(t.b)("inlineCode",{parentName:"p"},"inventory-<replace with namespace>")," using the dev namespace/project name you have been using.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Save the script, make it executable, and then run it by passing in the filename"),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-bash"}),"chmod +x ./dataload.sh\n./dataload.sh inventory.json\n"))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"The data from the ",Object(t.b)("inlineCode",{parentName:"p"},"inventory.json")," file will then be used to populate the database, to confirm this on the Dashboard click on Manage menu on the left and then Launch button to see the Cloudant dashboard.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Click on the Left icon that looks like a Database and you will see the ",Object(t.b)("inlineCode",{parentName:"p"},"inventory-<namespace>")," database created.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Click on the ",Object(t.b)("inlineCode",{parentName:"p"},"inventory")," database, then click ",Object(t.b)("strong",{parentName:"p"},"Table")," view.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"You can see the rows of data\n",Object(t.b)("span",o({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(t.b)("span",o({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"47.91666666666667%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABk0lEQVQoz4WSu27cQAxF9f+/4yp1ihTu0hkB4rWTlbQrjTTvh2Z2b0jKsgOnyADEEITm8PKK3aItllXDWoeUMspWcZ49bMjIpSJvDbVStD1auyHlDasJcKEgxoRA8fQy4fms0BkXsdWbPEqpYLURXx5fcRoM5QnnydLDLA20y/CxwPosETin+qwjHr6d8PV7j04bQ10b7vc7gStWUqzUIqpnpTFOi6hctKN8RUwb1GoJnkhplbojsBxidCkXGYWBPOLroPD084wfpx7Pv6+4Lh4mVPSTwa9RQZmMgXJlMxZXRN3qN8xU51oHHPA72u0GtWj0w4hhJNikYJwXS7Rx0ORzIWuM9eIjCwhx9333u+5AhgmwvQF7Bl4wzQQkSG0MtLhcJ3q4SY0nY1BM+33EP0D2jtXx45m8dD4I0JLSZTWi5FC4A/P/gePlA8igAzirVRRyE77/HvkTEJ8UXgQ6zzuQPWRV3IQBO7C+K9zI17K1D+Bx+G/zgpu38IF2lD7iRoUUpZToLrJekXJear6DLPeu9A+TjQRNk4tVqgAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(t.b)("img",o({parentName:"span"},{className:"gatsby-resp-image-image",alt:"Database",title:"Database",src:"/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/3cbba/database.png",srcSet:["/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/7fc1e/database.png 288w","/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/a5df1/database.png 576w","/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/3cbba/database.png 1152w","/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/0b124/database.png 1728w","/ibm-gsi-cloudnative-journey/static/9b560c3709cfb5556d183c9af0c51c44/fac46/database.png 1746w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"If you click on a row of data, you will see the raw NoSQL form of the data record.")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"This completes the setup of the database and populating it with data."))),Object(t.b)("h3",null,"Enable database in the solution"),Object(t.b)("p",null,"If you are starting from the solution, use the following steps to enable the Cloudant database"),Object(t.b)("h4",null,"Set up local development"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open the mappings.json file under src/main/resources and add a ",Object(t.b)("inlineCode",{parentName:"p"},"DATABASE_NAME")," value with the value ",Object(t.b)("inlineCode",{parentName:"p"},"inventory-{namespace}")," where ",Object(t.b)("inlineCode",{parentName:"p"},"namespace")," is the namespace where the pipeline is running (e.g. dev-{initials})"),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-json",metastring:"path=src/main/resources/mappings.json",path:"src/main/resources/mappings.json"}),'{\n  "DATABASE_NAME": "inventory-{namespace}"\n}\n'))),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Log into cloud.ibm.com and open the Cloudant service from the resource list")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Click on service credentials and expand the listed credentials")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Copy the json contents from the credentials into ",Object(t.b)("inlineCode",{parentName:"p"},"mappings.json")," under the ",Object(t.b)("inlineCode",{parentName:"p"},"CLOUDANT_CONFIG")," object (note that CLOUDANT_CONFIG value must be a string type not a json type, so you must use escaping characters for this value)"),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-json",metastring:"path=src/main/resources/mappings.json",path:"src/main/resources/mappings.json"}),'{\n  "DATABASE_NAME": "inventory-{namespace}",\n  "CLOUDANT_CONFIG": "{paste json here}"\n}\n')))),Object(t.b)("h4",null,"Activate the Clouant service implementation"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open ",Object(t.b)("inlineCode",{parentName:"p"},"src/main/java/com/ibm/inventory_management/services/StockItemMockService.java")," and remove the ",Object(t.b)("inlineCode",{parentName:"p"},"@Primary")," annotation")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open ",Object(t.b)("inlineCode",{parentName:"p"},"src/main/java/com/ibm/inventory_management/services/StockItemService.java")," and add the ",Object(t.b)("inlineCode",{parentName:"p"},"@Primary")," annotation. The file should look like the following"),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/services/StockItemService.java",path:"src/main/java/com/ibm/inventory_management/services/StockItemService.java"}),'package com.ibm.inventory_management.services;\n\nimport java.io.IOException;\nimport java.util.List;\nimport javax.annotation.PostConstruct;\n\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.stereotype.Service;\n\nimport com.cloudant.client.api.CloudantClient;\nimport com.cloudant.client.api.Database;\nimport com.ibm.inventory_management.config.CloudantConfig;\nimport com.ibm.inventory_management.models.StockItem;\n\n@Service\n@Primary\npublic class StockItemService implements StockItemApi {\n    private CloudantConfig config;\n    private CloudantClient client;\n    private Database db = null;\n\n    public StockItemService(CloudantConfig config, CloudantClient client) {\n        this.config = config;\n        this.client = client;\n    }\n\n    @PostConstruct\n    public void init() {\n        db = client.database(config.getDatabaseName(), true);\n    }\n\n    @Override\n    public List<StockItem> listStockItems() throws Exception {\n\n        try {\n            return db.getAllDocsRequestBuilder()\n                    .includeDocs(true)\n                    .build()\n                    .getResponse()\n                    .getDocsAs(StockItem.class);\n\n        } catch (IOException e) {\n            throw new Exception("", e);\n        }\n    }\n}\n')))),Object(t.b)("h4",null,"Update the configuration values in the ",Object(t.b)("inlineCode",{parentName:"h4"},"values.yaml")," helm chart"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Open the ",Object(t.b)("inlineCode",{parentName:"p"},"values.yaml")," file and update the values for ",Object(t.b)("inlineCode",{parentName:"p"},"cloudantBinding")," and ",Object(t.b)("inlineCode",{parentName:"p"},"databaseName")),Object(t.b)("pre",{parentName:"li"},Object(t.b)("code",o({parentName:"pre"},{className:"language-yaml",metastring:"path=chart/template-java-spring/values.yaml",path:"chart/template-java-spring/values.yaml"}),'cloudantBinding="{binding name}"\ndatabaseName="inventory-{namespace}"\n')),Object(t.b)("p",{parentName:"li"},"  ",Object(t.b)("strong",{parentName:"p"},"Note:")," The cloudantBinding value should match the name of the cloudant binding secret"))),Object(t.b)("h3",null,"(For manual solution) Add a Cloudant integration to your backend service"),Object(t.b)("p",null,"If you are following the instructions from MicroApp part 1 and want to enable the Cloudant database\nyourself, use the following directions."),Object(t.b)("h4",null,"Update the gradle config to include cloudant dependencies"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Add ",Object(t.b)("inlineCode",{parentName:"li"},"build-services.gradle")," to the gradle folder")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-groovy",metastring:"path=gradle/build-cloudant.gradle",path:"gradle/build-cloudant.gradle"}),"dependencies {\n    compile group: 'com.cloudant', name: 'cloudant-client', version: '2.17.0'\n    compile group: 'com.jayway.jsonpath', name: 'json-path', version: '2.4.0'\n    compile group: 'javax.xml.bind', name: 'jaxb-api', version: '2.1'\n    compile group: 'joda-time', name: 'joda-time', version: '2.10.3'\n}\n")),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Enable the cloudant libraries by applying the ",Object(t.b)("inlineCode",{parentName:"li"},"build-cloudant.gradle")," to the end of the\nbuild.gradle file")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-groovy",metastring:"path=build.gradle",path:"build.gradle"}),"apply from:   'gradle/build-cloudant.gradle'\n")),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Run ",Object(t.b)("inlineCode",{parentName:"li"},"./gradlew init")," to validate the changes and load the libraries ")),Object(t.b)("h4",null,"Add configuration values"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Add CloudantConfig to hold the url, username, password, and databaseName values")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/config/CloudantConfig.java",path:"src/main/java/com/ibm/inventory_management/config/CloudantConfig.java"}),'package com.ibm.inventory_management.config;\n\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n\n@JsonIgnoreProperties(ignoreUnknown = true)\npublic class CloudantConfig {\n    private String url;\n    private String username;\n    private String password;\n    private String databaseName;\n\n    public String getUrl() {\n        return url;\n    }\n\n    public void setUrl(String url) {\n        this.url = url;\n    }\n\n    public CloudantConfig withUrl(String url) {\n        this.setUrl(url);\n\n        return this;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public CloudantConfig withUsername(String username) {\n        this.setUsername(username);\n\n        return this;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public CloudantConfig withPassword(String password) {\n        this.setPassword(password);\n\n        return this;\n    }\n\n    public String getDatabaseName() {\n        return databaseName;\n    }\n\n    public void setDatabaseName(String databaseName) {\n        this.databaseName = databaseName;\n    }\n\n    public CloudantConfig withDatabaseName(String databaseName) {\n        this.setDatabaseName(databaseName);\n\n        return this;\n    }\n\n    public String toString() {\n        return "[CloudantConfig: url=" + this.url + ", username=" + this.username + ", name=" + this.databaseName + "]";\n    }\n}\n')),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Implement logic to load the configuration from the secret binding or local file")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/config/CloudantMapping.java",path:"src/main/java/com/ibm/inventory_management/config/CloudantMapping.java"}),'package com.ibm.inventory_management.config;\n\nimport java.io.Serializable;\n\nimport com.fasterxml.jackson.annotation.JsonProperty;\n\npublic class CloudantMapping implements Serializable {\n    @JsonProperty(value = "CLOUDANT_CONFIG")\n    private String cloudantConfig;\n    @JsonProperty(value = "DATABASE_NAME")\n    private String databaseName;\n\n    public String getCloudantConfig() {\n        return cloudantConfig;\n    }\n\n    public void setCloudantConfig(String cloudantConfig) {\n        this.cloudantConfig = cloudantConfig;\n    }\n\n    public String getDatabaseName() {\n        return databaseName;\n    }\n\n    public void setDatabaseName(String databaseName) {\n        this.databaseName = databaseName;\n    }\n}\n')),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/config/CloudantConfigFactory.java",path:"src/main/java/com/ibm/inventory_management/config/CloudantConfigFactory.java"}),'package com.ibm.inventory_management.config;\n\nimport java.io.IOException;\n\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class CloudantConfigFactory {\n    @Bean\n    public CloudantConfig buildCloudantConfig() throws IOException {\n        return buildConfigFromBinding(\n                loadCloudantConfig(),\n                loadDatabaseName()\n        );\n    }\n\n    protected String loadCloudantConfig() throws IOException {\n        return System.getProperty("CLOUDANT_CONFIG") != null\n                ? System.getProperty("CLOUDANT_CONFIG")\n                : loadCloudantMappingFromLocalDev().getCloudantConfig();\n    }\n\n    protected CloudantMapping loadCloudantMappingFromLocalDev() throws IOException {\n        final ObjectMapper mapper = new ObjectMapper();\n\n        return mapper.readValue(\n                this.getClass().getClassLoader().getResourceAsStream("mappings.json"),\n                CloudantMapping.class\n        );\n    }\n\n    protected String loadDatabaseName() throws IOException {\n        return System.getProperty("DATABASE_NAME") != null\n                ? System.getProperty("DATABASE_NAME")\n                : loadCloudantMappingFromLocalDev().getDatabaseName();\n    }\n\n    protected CloudantConfig buildConfigFromBinding(String binding, String databaseName) throws IOException {\n        final ObjectMapper mapper = new ObjectMapper();\n\n        return mapper.readValue(binding, CloudantConfig.class)\n                .withDatabaseName(databaseName);\n    }\n}\n')),Object(t.b)("h4",null,"Set up local development"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Open the mappings.json file under src/main/resources and add a ",Object(t.b)("inlineCode",{parentName:"li"},"DATABASE_NAME")," value with the value\n",Object(t.b)("inlineCode",{parentName:"li"},"inventory-{namespace}")," where ",Object(t.b)("inlineCode",{parentName:"li"},"namespace")," is the namespace where the pipeline is running (e.g. dev-{initials})")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-json",metastring:"path=src/main/resources/mappings.json",path:"src/main/resources/mappings.json"}),'{\n  "DATABASE_NAME": "inventory-{namespace}"\n}\n')),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Log into cloud.ibm.com and open the Cloudant service from the resource list")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Click on service credentials and expand the listed credentials")),Object(t.b)("li",{parentName:"ul"},Object(t.b)("p",{parentName:"li"},"Copy the json contents from the credentials into ",Object(t.b)("inlineCode",{parentName:"p"},"mappings.json")," under the ",Object(t.b)("inlineCode",{parentName:"p"},"CLOUDANT_CONFIG")," object"))),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-json",metastring:"path=src/main/resources/mappings.json",path:"src/main/resources/mappings.json"}),'{\n  "DATABASE_NAME": "inventory-{namespace}",\n  "CLOUDANT_CONFIG": "{paste json here}"\n}\n')),Object(t.b)("h4",null,"Implement the service"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Add a CloudantApi component to create the CloudantClient instance from the configuration")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/services/CloudServicesException.java",path:"src/main/java/com/ibm/inventory_management/services/CloudServicesException.java"}),"package com.ibm.inventory_management.services;\n\npublic class CloudServicesException extends Exception {\n    public CloudServicesException() {\n    }\n\n    public CloudServicesException(String message) {\n        super(message);\n    }\n\n    public CloudServicesException(String message, Throwable cause) {\n        super(message, cause);\n    }\n\n    public CloudServicesException(Throwable cause) {\n        super(cause);\n    }\n\n    public CloudServicesException(\n            String message,\n            Throwable cause,\n            boolean enableSuppression,\n            boolean writableStackTrace\n    ) {\n        super(message, cause, enableSuppression, writableStackTrace);\n    }\n}\n")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/services/CloudantApi.java",path:"src/main/java/com/ibm/inventory_management/services/CloudantApi.java"}),'package com.ibm.inventory_management.services;\n\nimport java.net.MalformedURLException;\nimport java.net.URL;\n\nimport com.cloudant.client.api.ClientBuilder;\nimport com.cloudant.client.api.CloudantClient;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Component;\n\nimport com.ibm.inventory_management.config.CloudantConfig;\n\n@Component\npublic class CloudantApi {\n    @Bean\n    public CloudantClient buildCloudant(CloudantConfig config) throws CloudServicesException {\n        System.out.println("Config: " + config);\n        URL url = null;\n        try {\n            url = new URL(config.getUrl());\n        } catch (MalformedURLException e) {\n            throw new CloudServicesException("Invalid service URL specified", e);\n        }\n\n        return ClientBuilder\n                .url(url)\n                .username(config.getUsername())\n                .password(config.getPassword())\n                .build();\n    }\n}\n')),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Add the service implementation")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-java",metastring:"path=src/main/java/com/ibm/inventory_management/services/StockItemService.java",path:"src/main/java/com/ibm/inventory_management/services/StockItemService.java"}),'package com.ibm.inventory_management.services;\n\nimport java.io.IOException;\nimport java.util.List;\nimport javax.annotation.PostConstruct;\n\nimport com.cloudant.client.api.CloudantClient;\nimport com.cloudant.client.api.Database;\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.stereotype.Service;\n\nimport com.ibm.inventory_management.config.CloudantConfig;\nimport com.ibm.inventory_management.models.StockItem;\n\n@Service\n@Primary\npublic class StockItemService implements StockItemApi {\n    private CloudantConfig config;\n    private CloudantClient client;\n    private Database db = null;\n\n    public StockItemService(CloudantConfig config, CloudantClient client) {\n        this.config = config;\n        this.client = client;\n    }\n\n    @PostConstruct\n    public void init() {\n        db = client.database(config.getDatabaseName(), true);\n    }\n\n    @Override\n    public List<StockItem> listStockItems() throws Exception {\n\n        try {\n            return db.getAllDocsRequestBuilder()\n                    .includeDocs(true)\n                    .build()\n                    .getResponse()\n                    .getDocsAs(StockItem.class);\n\n        } catch (IOException e) {\n            throw new Exception("", e);\n        }\n    }\n}\n')),Object(t.b)("ol",{start:3},Object(t.b)("li",{parentName:"ol"},"Remove the ",Object(t.b)("inlineCode",{parentName:"li"},"@Primary")," annotation from the mock service")),Object(t.b)("h4",null,"Add the values to the helm chart"),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Open the ",Object(t.b)("inlineCode",{parentName:"li"},"values.yaml")," file and add properties for ",Object(t.b)("inlineCode",{parentName:"li"},"cloudantBinding")," and ",Object(t.b)("inlineCode",{parentName:"li"},"databaseName")," to the top of the file")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-yaml",metastring:"path=chart/template-java-spring/values.yaml",path:"chart/template-java-spring/values.yaml"}),'cloudantBinding="{binding name}"\ndatabaseName="inventory-{namespace}"\n')),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{}),"**Note:** The cloudantBinding value should match the name of the cloudant binding secret\n")),Object(t.b)("ul",null,Object(t.b)("li",{parentName:"ul"},"Open the ",Object(t.b)("inlineCode",{parentName:"li"},"deployment.yaml")," file and add environment variables that use those values to the top of the\nexisting ",Object(t.b)("inlineCode",{parentName:"li"},"env")," block")),Object(t.b)("pre",null,Object(t.b)("code",o({parentName:"pre"},{className:"language-yaml",metastring:"path=chart/template-java-spring/templates/deployment.yaml",path:"chart/template-java-spring/templates/deployment.yaml"}),"          env:\n            - name: CLOUDANT_CONFIG\n              valueFrom:\n                secretKeyRef:\n                  name: {{ .Values.cloudantBinding | quote }}\n                  key: binding\n            - name: DATABASE_NAME\n              value: {{ .Values.databaseName | quote }}\n")))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-developer-advanced-inventory-cloudant-index-mdx-130cb680f536331a7c35.js.map